---
title: "Building code-movies with {flipbookr}"
author: "Gina Reynolds, "
date: "7/22/2020"
output: html_document
---


```{r, echo = F}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```


Have you heard of "code-movies" or "flipbooks"? Maybe not?  This blog post will tell you what they are, point you to tools to build them, and showcase student work and insights about building flipbooks. 

# What are flipbooks?

Flipbooks help you communicate how to get from ;A' to 'B' using data manipulation, analysis, or visualization pipelines.   When using R markdown or Jupytr notebooks, we often only see the input and output for a pipeline of steps.   Having the inputs and outputs nearby is really helpful in communicating the big picture of what is being accomplished with a chunk of code.  


```{r an_mtcars_flipbook, echo = F, eval = F}
set.seed(12345)
library(tidyverse)
mtcars %>% 
  rownames_to_column(var = "car_name") %>% 
  ggplot() +
  aes(x = wt) +
  aes(y = factor(cyl)) +
  geom_boxplot(fill = "snow2") +
  geom_jitter(height = .2,
              alpha = .7,
              color = "plum3",
              size = 3) +
  ggthemes::theme_solarized() +
  labs(title = "How do number of cylanders and car weight relate?") +
  labs(subtitle = "Yet another look at mtcars") +
  labs(y = "cylinder") + 
  labs(x = "weight (thousands of pounds)") +
  theme(plot.title.position = "plot") +
  geom_label(data = tibble(x = 1), # one row dataframe
             fill = "grey90",
             x = 4.9, 
             y = 1.2, # cylinder is a factor w 3 levels
             label = "These observations aren't part of the 'wiskers' of the Tukey box plot. Outliers are observations further than 1.5 IQR from the upper or lower hinge" %>% 
               str_wrap(25)) +
  geom_curve(data = tibble(x = 1),
             curvature = -.2,
             angle = 80,
             x = 4.9, xend = 5.2,
             y = 1.9, yend = 2.8,
             )
```





But newcomers and even seasoned practitioners might have trouble figuring out what individual steps in a pipeline accomplish.   This is where flipbooks come in! They seek to illuminate *what's going on in the in-between steps.*   Flipbooks do this by showing in-between outputs as the code is built up.  

Here's an example:  

```{r}
flipbookr::embed_flipbook("an_mtcars_flipbook",
                          font_size = 80,
                          use_share_again = T,
                          use_embed_xaringan = T)
```

### Early flipbooks

The 'flipbook' or code-movie technique is one that you are probably seeing more and more in coding presentations.  Presenters know that showing a code pipeline as it is built helps audiences digest workflows.  So they choreograph a set of slides to break down the build; if the alignment between slides is good --- and if we don't have disruptive slide transitions (wipes, spins, fades) --- we get to enjoy a little movie: the coordinated the evolution of code and output.  Here are some inspiring examples...

[Side-by-side display of code and output](https://www.garrickadenbuie.com/blog/decouple-code-and-output-in-xaringan-slides/) has made alignment for output better.  [Highlighting new code](https://www.garrickadenbuie.com/blog/highlight-lines-without-breaking-the-code-in-xaringan/) allows the user to focus more on the changes in output.  



<!--   -->

### Building flipbooks faster with {flipbookr}

While code-movies deliver helpful insight to consumers, putting together this code-movie experience can be time consuming for creators. There's a lot of copy-paste that has to happen to create the right partial code sequence -- and you can mix yourself up in trying to coordinate it (I've been there!).

The package [{flipbookr}](https://github.com/EvaMaeRey/flipbookr)'s goal is to help create these easy-to-follow-along-with step-by-step experiences --- without the copy and paste pain!


### Taking {flipbookr} for a spin

One way to get started with flipbookr is using this [Easy Flipbook Recipes](https://evamaerey.github.io/flipbooks/flipbook_recipes#1) guide. Or, you can use "A minimal flipbook" template that comes with the package.  Using R Studio, install flipbookr (and xaringan if you don't have it already installed): `remotes::install_github("EvaMaeRey/flipbookr")`.  Then get the template with `File -> New File -> Rmarkdown -> A Minimal Flipbook`

Soon, we also hope to be delivering mode of creating instant mini flipbooks from within Rmarkdown files with the function `flipbookr::embed_flipbook()`. You'll be able to write a pipeline in a code chunk, and in a subsequent code chunk, request an embedded flipbook that shows you the pipeline walk-through.  Stay tuned! Also, if you'd be so generous to [review/help](https://github.com/EvaMaeRey/flipbookr/blob/master/R/h_write_instant_flipbook.R).  




### Student work and insights

Before you start building your own flipbooks, it might also be useful to hear about the experience of designing flipbooks from some other folks.  Four of my graduate research assistants, with the support of an RConsortium Grant, have built several excellent flipbooks here, showcasing gganimation, ggplot maps, tmap and magick.  They offer some comments on the experience of writing them.  

<!-- So writing code for to create flipbooks is a little different than writing code only to accomplish a task.  It is more like choreographing an experience.  As much as possible, the creators should try to write the code so that their is feedback as code is revealed.    -->




> Conner's experience:

```{r}
xaringanExtra::embed_xaringan("AUS_InteractMap/AUS_tmap.html")
```



> Britt's experience:

```{r}
xaringanExtra::embed_xaringan("magick/magick.html")
```

> Luca's experience:


```{r}
xaringanExtra::embed_xaringan("unemployment/unemployment.html")
```

Rachel's experience:

```{r}
xaringanExtra::embed_xaringan("Idaho Mapping/Idaho_mapping.html")
```


> *The process of producing a flipbook pushed me to think differently about both data wrangling and data visualization. It required me to be more deliberate in how I wrote and ordered my code... - Rachel*

### Under the hood

So what is {flipbookr} doing? Basically {flipbookr} does four things: 

1. First it parses an Rmd code pipeline from a single chunk
2. Then it identifies good break points in the code chunk pipeline
3. Then it then constructs partial builds of code
4. Finally delivers these partial builds alongside associated outputs on slide show tool ([xaringan](https://github.com/yihui/xaringan)!). 

Overall, this gives you the movie-like experience. You can more directly relate a specific function to the change in output it results in.   There is so much cool decision making packed in code pipelines --- the {flipbookr} project is about appreciating those decisions and bringing them into the spotlight!

### {flipbookr} heroes

This project benefits a lot from generous help from folks.  Emi Tanaka and Garrick Aden Buie were instrumental to getting the flipbookr project off the ground.  Inspirations for flipbooks are ggplot2 and magrittr pipelines.  The sequential, incremental coding processes allowed by ggplot2 and magrittr pipelines makes code parsing easy and alignment basically automatic.  The knitr, xaringan, and remark.js tools have been amazing platforms for this project.  

Yihui Xie's Xaringan and Garrick Aden-Buies contributions to xaringan have put us in a position enjoy code movies. 


<!-- It required me to be more deliberate in how I wrote and ordered my code, and it revealed redundancies and other inefficiencies in my script. The process also deepened my understanding of the commands that I employed by allowing me to see the output of each individual line of code. -->